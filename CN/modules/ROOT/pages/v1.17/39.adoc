
:sectnums:
:sectnumlevels: 5

= VectorChord

== 概述
VectorChord 是 PostgreSQL 的一个高性能、可扩展的向量搜索扩展，被视为 pgvecto.rs 的继任者。它专为处理大规模向量数据而设计，能够在有限的硬件资源下高效存储和检索高维向量，显著降低了向量搜索的存储与计算成本。

该扩展具备卓越的性能表现，其查询速度比 pgvector 快达 5 倍，并支持最高 60,000 维的向量。通过创新的 RaBitQ 压缩技术和 IVF 索引，VectorChord 实现了磁盘存储效率的极大提升，宣称仅需 1 美元即可存储 40 万条向量，成本效率远超同类服务。

VectorChord 完全兼容 pgvector 的数据类型和查询语法，确保了无缝的迁移和集成体验。它已成功应用于生产环境，可靠地管理了超过 30 亿个向量，是构建新一代 AI 应用和进行海量相似性搜索的理想基础组件。

== 安装
根据开发环境，用户可从 https://docs.vectorchord.ai/vectorchord/getting-started/installation.html[VectorChord安装] 页面选择适合自己的方式进行VectorChord安装。

=== 源码安装
除VectorChord社区提供的安装方式以外，IvorySQL社区也提供了源码安装方式，源码安装环境为 Ubuntu 24.04(x86_64)。
在编译前需要确保clang和rust已经安装：
clang版本要求 >= 16, 包含libclang；
rust版本要求 >= 1.89， 包含cargo

[TIP]
环境中已经安装了IvorySQL1.17及以上版本，安装路径为/usr/local/ivorysql/ivorysql-1

==== 安装 Clang

** 安装clang 16 编译器和 libclang 开发库
```
sudo apt update
sudo apt install clang-16 libclang-16-dev
```

** 验证安装
```
$ clang-16 --version
Ubuntu clang version 16.0.6 (23ubuntu4)
Target: x86_64-pc-linux-gnu
Thread model: posix
InstalledDir: /usr/bin
```

** 设置默认 Clang (可选)：​​ 类似 GCC，你可以设置默认版本：
```
sudo update-alternatives --install /usr/bin/clang clang /usr/bin/clang-16 100
sudo update-alternatives --install /usr/bin/clang++ clang++ /usr/bin/clang++-16 100
```

** 验证默认版本
```
clang --version  # 应该显示 clang-16
clang++ --version
```

** 设置LIBCLANG_PATH路径：通常安装 libclang-16-dev后会自动设置，但最好确认或显式设置
```
# 查找 libclang.so 的位置 (通常是 /usr/lib/llvm-16/lib/libclang.so.1 或类似)
find /usr -name 'libclang.so*' 2>/dev/null

# 设置环境变量
export LIBCLANG_PATH=/usr/lib/llvm-16/lib  # 通常设置包含该文件的目录即可

# 为了永久生效，可以将上面这行 export 命令添加到你的 shell 配置文件 (~/.bashrc 或 ~/.zshrc) 中
```

==== 安装 Rust(>=1.89) 和 Cargo
按照 Vectorchord 和 Rust 官方的推荐，使用 rustup安装是最佳实践。
安装 rustup：
```
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
# 运行脚本后，它会提示你。按 1选择默认安装
```

激活环境：​​ 安装完成后，你需要让新的 PATH 设置生效
```
source "$HOME/.cargo/env"  # 当前终端会话生效
```

验证安装：
```
rustc --version  # 应该输出类似 rustc 1.xx.x (稳定版版本号 >= 1.89)
cargo --version  # 应该输出 cargo 的版本号
```

=== 安装 VectorChord

```
# 拉取vectorchord源码
curl -fsSL https://github.com/tensorchord/VectorChord/archive/refs/tags/0.5.1.tar.gz | tar -xz
cd VectorChord-0.5.1
# 将pg_config的路径设置到PATH环境变量里，eg：
export PATH=/usr/local/ivorysql/ivorysql-1/bin/:$PATH
make build
make install
```

== 配置ivorysql.conf 文件
```
# 共享预加载扩展
shared_preload_libraries = 'vchord'
```

== 重启服务

```
pg_ctl restart -D ./data -l logfile
```

== 创建Extension并确认VectorChord版本

psql 连接到数据库，执行如下命令：
```
ivorysql=# CREATE EXTENSION IF NOT EXISTS vchord CASCADE;
CREATE EXTENSION

ivorysql=# SELECT * FROM pg_available_extensions WHERE name = 'vchord';
  name   | default_version | installed_version |                          comment
---------+-----------------+-------------------+--------------------------------------------------------------------------------------------
  vchord | 0.5.1           | 0.5.1             | vchord: Vector database plugin for Postgres, written in Rust, specifically designed for LLM
(1 row)
```

== 使用
关于VectorChord的使用，请参阅 https://docs.vectorchord.ai/vectorchord/getting-started/overview.html[VectorChord官方文档]