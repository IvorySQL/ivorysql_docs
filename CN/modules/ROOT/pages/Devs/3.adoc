
:sectnums:
:sectnumlevels: 5

= 引用标识符的大小写转换设计

== 目的

- 为了满足pg和oracle的引用标识符大小写兼容，ivorysql设计了三种引用标识符的大小写转换模式。通过guc参数“identifier_case_switch”选择转换模式。

== 方案

=== 大小写转换的三种模式（默认为interchange）

- 如果 guc 参数“identifier_case_switch”值为“interchange”：

   	1). 如果双引号所引用的标识符中的字母全部为大写，则将大写转换为小写。

      	2). 如果双引号所引用的标识符中的字母全部为小写，则将小写转换为大写。

      	3). 如果用双引号引起来的标识符中的字母是大小写混合的，则保持标识符不变。

=== 大小写转换的位置

- 在用户建立连接的过程，如果开启了大小写转换，需要将用户名和数据库名按大小写转换模式进行转换。
-  收到用户的sql后，在san.l进行SQL解析时，需要对加了双引号的字符串按大小写转换模式进行转换。

=== 初始化数据库集簇时

- 在initdb程序中加入 -C选项设置大小写转换模式，-C对应的值为：

  "normal"   ------ "0"同义

  "interchange" ------ "1"同义

  "lowercase"  ------ "2"同义

  在初始化数据库集簇的过程中，将大小写转换模式保存到data目录的global/pg_control文件中。